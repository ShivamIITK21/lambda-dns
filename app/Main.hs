module Main (main) where

import qualified Net.Listener as L
import qualified Data.MonadicByteString as MS
import qualified Data.ByteString as BS
import qualified Protocol.Packet as P 
import qualified Protocol.Question as P 
import Control.Monad.State
import Net.Stub (sendDNSStubRequest)
import Protocol.Packet (parseDNSPacket)
import Debug.Trace(trace)
import Net.Resolver (lookupDomain)
import Net.IPv4 (fromOctets)


main :: IO ()
main = do
    -- let request =  BS.pack [0x41, 0xC5, 0x01, 0x20, 0x00, 0x01, 0x00, 0x00, 
    --                          0x00, 0x00, 0x00, 0x00, 0x06, 0x67, 0x6F, 0x6F, 
    --                          0x67, 0x6C, 0x65, 0x03, 0x63, 0x6F, 0x6D, 0x00, 
    --                          0x00, 0x01, 0x00, 0x01]
    -- let request2 = BS.pack [0xC3, 0x6C, 0x01, 0x20, 0x00, 0x01, 0x00, 0x00, 
    --                          0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 
    --                          0x05, 0x79, 0x61, 0x68, 0x6F, 0x6F, 0x03, 0x63, 
    --                          0x6F, 0x6D, 0x00, 0x00, 0x01, 0x00, 0x01]
    -- let cname_answer = BS.pack [0x41, 0x12, 0x81, 0x80, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x08, 0x63, 0x61, 0x6C, 0x65, 0x6E, 0x64, 0x61, 0x72, 0x07, 0x73, 0x6E, 0x74, 0x69, 0x69, 0x74, 0x6B, 0x03, 0x63, 0x6F, 0x6D, 0x00, 0x00, 0x05, 0x00, 0x01, 0xC0, 0x0C, 0x00, 0x05, 0x00, 0x01, 0x00, 0x00, 0x0E, 0x10, 0x00, 0x1A, 0x10, 0x67, 0x79, 0x6D, 0x6B, 0x68, 0x61, 0x6E, 0x61, 0x63, 0x61, 0x6C, 0x65, 0x6E, 0x64, 0x61, 0x72, 0x03, 0x77, 0x65, 0x62, 0x03, 0x61, 0x70, 0x70, 0x00, 0x00, 0x00, 0x29, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
    -- let packet =  BS.pack 
    --         [ 0x41, 0xC5, 0x81, 0x80, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00
    --         , 0x06, 0x67, 0x6F, 0x6F, 0x67, 0x6C, 0x65, 0x03, 0x63, 0x6F, 0x6D, 0x00
    --         , 0x00, 0x01, 0x00, 0x01, 0xC0, 0x0C, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00
    --         , 0x00, 0x2F, 0x00, 0x04, 0xAC, 0xD9, 0xA6, 0x0E 
    --         ]
    -- L.startServer "8080"
    response <- lookupDomain "www.iitk.ac.in" P.A (fromOctets 198 97 190 53)
    print response
